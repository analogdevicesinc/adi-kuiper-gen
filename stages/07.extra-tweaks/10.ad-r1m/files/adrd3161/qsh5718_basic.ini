# SPDX-License-Identifier: Apache-2.0
#
# A basic set of ADRD3161 (TMC9660) parameters for QSH5718 stepper motors
# Tuned using TMCL-IDE as well as a moderate amount of manual intervention
# Relaxed, P-only velocity controller avoids oscillating behaviour but also doesn't use the motor to its fullest
#
# Copyright (c) 2025 Analog Devices, Inc.
# Author: Ioan Dragomir <ioan.dragomir@analog.com>

MOTOR_TYPE=2
ABN_1_STEPS=40000
ABN_1_DIRECTION=0
ABN_1_INIT_METHOD=0
ABN_1_INIT_DELAY=1000
ABN_1_INIT_VELOCITY=5
ABN_1_N_CHANNEL_PHI_E_OFFSET=0
ABN_1_N_CHANNEL_INVERTED=0
ABN_1_N_CHANNEL_FILTERING=0
MOTOR_POLE_PAIRS=50
MOTOR_DIRECTION=0
MOTOR_PWM_FREQUENCY=50000
OUTPUT_VOLTAGE_LIMIT=20000
MAX_TORQUE=2500
MAX_FLUX=2500
PWM_SWITCHING_SCHEME=1
IDLE_MOTOR_PWM_BEHAVIOR=1
ADC_SHUNT_TYPE=4
CSA_GAIN_ADC_I0_TO_ADC_I2=1
CSA_GAIN_ADC_I3=1
CSA_FILTER_ADC_I0_TO_ADC_I2=0
CSA_FILTER_ADC_I3=0
CURRENT_SCALING_FACTOR=390
PHASE_UX1_ADC_MAPPING=0
PHASE_VX2_ADC_MAPPING=1
PHASE_WY1_ADC_MAPPING=2
PHASE_Y2_ADC_MAPPING=3
ADC_I0_SCALE=1024
ADC_I1_SCALE=1024
ADC_I2_SCALE=1024
ADC_I3_SCALE=1024
ADC_I0_INVERTED=1
ADC_I1_INVERTED=0
ADC_I2_INVERTED=1
ADC_I3_INVERTED=0
ADC_I0_OFFSET=-1
ADC_I1_OFFSET=11
ADC_I2_OFFSET=-26
ADC_I3_OFFSET=-12
OPENLOOP_CURRENT=2000
OPENLOOP_VOLTAGE=1638
ACCELERATION_FF_GAIN=8
ACCELERATION_FF_SHIFT=4
RAMP_ENABLE=1
DIRECT_VELOCITY_MODE=1
RAMP_AMAX=50000
RAMP_A1=50000
RAMP_A2=50000
RAMP_DMAX=50000
RAMP_D1=50000
RAMP_D2=50000
RAMP_VMAX=4375000
RAMP_V1=0
RAMP_V2=0
RAMP_VSTART=0
RAMP_VSTOP=1
RAMP_TVMAX=0
RAMP_TZEROWAIT=0
ACCELERATION_FEEDFORWARD_ENABLE=0
VELOCITY_FEEDFORWARD_ENABLE=1
TORQUE_P=840
TORQUE_I=2340
FLUX_P=840
FLUX_I=2340
SEPARATE_TORQUE_FLUX_PI_PARAMTERS=0
CURRENT_NORM_P=0
CURRENT_NORM_I=1
VELOCITY_SENSOR_SELECTION=0
VELOCITY_P=300
VELOCITY_I=0
VELOCITY_NORM_P=1
VELOCITY_NORM_I=1
VELOCITY_SCALING_FACTOR=1
VELOCITY_LOOP_DOWNSAMPLING=5
VELOCITY_REACHED_THRESHOLD=100000
VELOCITY_METER_SWITCH_THRESHOLD=2000
VELOCITY_METER_SWITCH_HYSTERESIS=500
POSITION_SENSOR_SELECTION=0
POSITION_SCALING_FACTOR=1024
POSITION_P=30
POSITION_I=0
POSITION_NORM_P=0
POSITION_NORM_I=1
STOP_ON_POSITION_DEVIATION=0
POSITION_LOOP_DOWNSAMPLING=0
POSITION_LIMIT_LOW=-2147483648
POSITION_LIMIT_HIGH=2147483647
POSITION_REACHED_THRESHOLD=0
EVENT_STOP_SETTINGS=0
BRAKE_CHOPPER_ENABLE=0
BRAKE_CHOPPER_VOLTAGE_LIMIT=260
BRAKE_CHOPPER_HYSTERESIS=5
RELEASE_BRAKE=0
BRAKE_RELEASING_DUTY_CYCLE=75
BRAKE_HOLDING_DUTY_CYCLE=11
BRAKE_RELEASING_DURATION=80
INVERT_BRAKE_OUTPUT=0
THERMAL_WINDING_TIME_CONSTANT_1=3000
THERMAL_WINDING_TIME_CONSTANT_2=6000
PWM_L_OUTPUT_POLARITY=0
PWM_H_OUTPUT_POLARITY=0
BREAK_BEFORE_MAKE_TIME_LOW_UVW=0
BREAK_BEFORE_MAKE_TIME_HIGH_UVW=0
BREAK_BEFORE_MAKE_TIME_LOW_Y2=0
BREAK_BEFORE_MAKE_TIME_HIGH_Y2=0
USE_ADAPTIVE_DRIVE_TIME_UVW=1
USE_ADAPTIVE_DRIVE_TIME_Y2=1
DRIVE_TIME_SINK_UVW=40
DRIVE_TIME_SOURCE_UVW=40
DRIVE_TIME_SINK_Y2=40
DRIVE_TIME_SOURCE_Y2=40
BOOTSTRAP_CURRENT_LIMIT=7
UNDERVOLTAGE_PROTECTION_SUPPLY_LEVEL=0
UNDERVOLTAGE_PROTECTION_VDRV_ENABLE=1
UNDERVOLTAGE_PROTECTION_BST_UVW_ENABLE=0
UNDERVOLTAGE_PROTECTION_BST_Y2_ENABLE=0
OVERCURRENT_PROTECTION_UVW_LOW_SIDE_ENABLE=1
OVERCURRENT_PROTECTION_UVW_HIGH_SIDE_ENABLE=1
OVERCURRENT_PROTECTION_Y2_LOW_SIDE_ENABLE=1
OVERCURRENT_PROTECTION_Y2_HIGH_SIDE_ENABLE=1
OVERCURRENT_PROTECTION_UVW_LOW_SIDE_THRESHOLD=1
OVERCURRENT_PROTECTION_UVW_HIGH_SIDE_THRESHOLD=2
OVERCURRENT_PROTECTION_Y2_LOW_SIDE_THRESHOLD=1
OVERCURRENT_PROTECTION_Y2_HIGH_SIDE_THRESHOLD=2
OVERCURRENT_PROTECTION_UVW_LOW_SIDE_BLANKING=2
OVERCURRENT_PROTECTION_UVW_HIGH_SIDE_BLANKING=2
OVERCURRENT_PROTECTION_Y2_LOW_SIDE_BLANKING=2
OVERCURRENT_PROTECTION_Y2_HIGH_SIDE_BLANKING=2
OVERCURRENT_PROTECTION_UVW_LOW_SIDE_DEGLITCH=6
OVERCURRENT_PROTECTION_UVW_HIGH_SIDE_DEGLITCH=6
OVERCURRENT_PROTECTION_Y2_LOW_SIDE_DEGLITCH=6
OVERCURRENT_PROTECTION_Y2_HIGH_SIDE_DEGLITCH=6
OVERCURRENT_PROTECTION_UVW_LOW_SIDE_USE_VDS=0
OVERCURRENT_PROTECTION_Y2_LOW_SIDE_USE_VDS=0
VGS_SHORT_ON_PROTECTION_UVW_LOW_SIDE_ENABLE=1
VGS_SHORT_OFF_PROTECTION_UVW_LOW_SIDE_ENABLE=1
VGS_SHORT_ON_PROTECTION_UVW_HIGH_SIDE_ENABLE=1
VGS_SHORT_OFF_PROTECTION_UVW_HIGH_SIDE_ENABLE=1
VGS_SHORT_ON_PROTECTION_Y2_LOW_SIDE_ENABLE=1
VGS_SHORT_OFF_PROTECTION_Y2_LOW_SIDE_ENABLE=1
VGS_SHORT_ON_PROTECTION_Y2_HIGH_SIDE_ENABLE=1
VGS_SHORT_OFF_PROTECTION_Y2_HIGH_SIDE_ENABLE=1
VGS_SHORT_PROTECTION_UVW_BLANKING=1
VGS_SHORT_PROTECTION_Y2_BLANKING=1
VGS_SHORT_PROTECTION_UVW_DEGLITCH=1
VGS_SHORT_PROTECTION_Y2_DEGLITCH=1
GDRV_RETRY_BEHAVIOUR=0
DRIVE_FAULT_BEHAVIOUR=0
FAULT_HANDLER_NUMBER_OF_RETRIES=5
SUPPLY_OVERVOLTAGE_WARNING_THRESHOLD=710
SUPPLY_UNDERVOLTAGE_WARNING_THRESHOLD=78
EXTERNAL_TEMPERATURE_SHUTDOWN_THRESHOLD=65535
EXTERNAL_TEMPERATURE_WARNING_THRESHOLD=65535
CHIP_TEMPERATURE_SHUTDOWN_THRESHOLD=65535
CHIP_TEMPERATURE_WARNING_THRESHOLD=65535
FIELDWEAKENING_I=0
FIELDWEAKENING_VOLTAGE_THRESHOLD=32767
TARGET_TORQUE_BIQUAD_FILTER_ENABLE=0
TARGET_TORQUE_BIQUAD_FILTER_ACOEFF_1=0
TARGET_TORQUE_BIQUAD_FILTER_ACOEFF_2=0
TARGET_TORQUE_BIQUAD_FILTER_BCOEFF_0=1048576
TARGET_TORQUE_BIQUAD_FILTER_BCOEFF_1=0
TARGET_TORQUE_BIQUAD_FILTER_BCOEFF_2=0
ACTUAL_VELOCITY_BIQUAD_FILTER_ENABLE=1
ACTUAL_VELOCITY_BIQUAD_FILTER_ACOEFF_1=1038090
ACTUAL_VELOCITY_BIQUAD_FILTER_ACOEFF_2=0
ACTUAL_VELOCITY_BIQUAD_FILTER_BCOEFF_0=3491
ACTUAL_VELOCITY_BIQUAD_FILTER_BCOEFF_1=3491
ACTUAL_VELOCITY_BIQUAD_FILTER_BCOEFF_2=3491

